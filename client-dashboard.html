<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Dashboard | Karma Marketing + Media</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        body { background: #0f172a; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .glass-light { background: rgba(255,255,255,0.95); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-border { border: 2px solid transparent; background: linear-gradient(#1e293b, #1e293b) padding-box, linear-gradient(135deg, #667eea, #764ba2, #f093fb) border-box; }
        .stat-card { transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(102,126,234,0.2); }
        .content-card { transition: all 0.3s; }
        .content-card:hover { transform: translateY(-2px); }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .blog-content { line-height: 1.8; }
        .blog-content h2 { font-size: 1.5rem; font-weight: 700; margin: 1.5rem 0 1rem; color: #1e293b; }
        .blog-content h3 { font-size: 1.25rem; font-weight: 600; margin: 1.25rem 0 0.75rem; color: #334155; }
        .blog-content p { margin-bottom: 1rem; color: #475569; }
        .blog-content ul, .blog-content ol { margin: 1rem 0; padding-left: 1.5rem; }
        .blog-content li { margin-bottom: 0.5rem; color: #475569; }
        .blog-content a { color: #667eea; text-decoration: underline; }
        .internal-link { background: linear-gradient(135deg, #667eea20, #764ba220); padding: 2px 6px; border-radius: 4px; }
        .tab-active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-top-color: #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .social-gbp { border-left: 4px solid #4285f4; }
        .social-facebook { border-left: 4px solid #1877f2; }
        .social-instagram { border-left: 4px solid #e4405f; }
        
        /* Onboarding Tour Styles */
        .tour-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 9998; }
        .tour-highlight { position: relative; z-index: 9999; box-shadow: 0 0 0 4px #8b5cf6, 0 0 0 9999px rgba(0,0,0,0.7); border-radius: 8px; }
        .tour-tooltip { position: fixed; z-index: 10000; background: white; border-radius: 12px; padding: 20px; max-width: 320px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .tour-tooltip::before { content: ''; position: absolute; width: 12px; height: 12px; background: white; transform: rotate(45deg); }
        .tour-tooltip.top::before { bottom: -6px; left: 50%; margin-left: -6px; }
        .tour-tooltip.bottom::before { top: -6px; left: 50%; margin-left: -6px; }
        .tour-tooltip.left::before { right: -6px; top: 50%; margin-top: -6px; }
        .tour-tooltip.right::before { left: -6px; top: 50%; margin-top: -6px; }
        .tour-progress { display: flex; gap: 4px; margin-top: 16px; }
        .tour-progress-dot { width: 8px; height: 8px; border-radius: 50%; background: #e2e8f0; }
        .tour-progress-dot.active { background: #8b5cf6; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="glass rounded-2xl p-8 w-full max-w-md mx-4 fade-in">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold gradient-text mb-2" data-brand="name">Karma Marketing + Media</h1>
                <p class="text-gray-400">Content Dashboard</p>
            </div>
            <div class="space-y-4">
                <input type="hidden" id="apiUrl" value="">
                <input type="email" id="loginEmail" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-purple-500" placeholder="Email">
                <input type="password" id="loginPassword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-purple-500" placeholder="Password">
                <button onclick="doLogin()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl text-white font-semibold hover:opacity-90 transition">
                    Sign In
                </button>
                <p id="authError" class="text-red-400 text-sm text-center hidden"></p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Navigation Bar -->
        <nav class="bg-slate-900 border-b border-white/10">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex items-center justify-between h-12">
                    <!-- Mobile menu button -->
                    <button onclick="toggleMobileNav()" class="md:hidden p-2 text-gray-400 hover:text-white">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <!-- Desktop nav -->
                    <div class="hidden md:flex items-center gap-6 text-sm">
                        <a href="/agency" class="text-gray-400 hover:text-white transition flex items-center gap-2">
                            <i class="fas fa-building"></i> Agency
                        </a>
                        <a href="/client" class="text-white font-medium flex items-center gap-2">
                            <i class="fas fa-file-alt"></i> Content
                        </a>
                        <a href="/elite" class="text-gray-400 hover:text-white transition flex items-center gap-2">
                            <i class="fas fa-chart-line"></i> SEO Elite
                        </a>
                        <a href="/intake" class="text-gray-400 hover:text-white transition flex items-center gap-2">
                            <i class="fas fa-plus-circle"></i> New Client
                        </a>
                        <a href="/admin" class="text-gray-400 hover:text-white transition flex items-center gap-2">
                            <i class="fas fa-cog"></i> Admin
                        </a>
                    </div>
                    <div class="text-xs text-gray-500">
                        <span class="text-purple-400">MCP</span> Framework
                    </div>
                </div>
                
                <!-- Mobile nav dropdown -->
                <div id="mobileNav" class="hidden md:hidden pb-4">
                    <div class="flex flex-col gap-2 text-sm">
                        <a href="/agency" class="text-gray-400 hover:text-white transition flex items-center gap-2 py-2">
                            <i class="fas fa-building w-5"></i> Agency
                        </a>
                        <a href="/client" class="text-white font-medium flex items-center gap-2 py-2">
                            <i class="fas fa-file-alt w-5"></i> Content
                        </a>
                        <a href="/elite" class="text-gray-400 hover:text-white transition flex items-center gap-2 py-2">
                            <i class="fas fa-chart-line w-5"></i> SEO Elite
                        </a>
                        <a href="/intake" class="text-gray-400 hover:text-white transition flex items-center gap-2 py-2">
                            <i class="fas fa-plus-circle w-5"></i> New Client
                        </a>
                        <a href="/admin" class="text-gray-400 hover:text-white transition flex items-center gap-2 py-2">
                            <i class="fas fa-cog w-5"></i> Admin
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Header -->
        <header class="glass border-b border-white/10 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-rocket text-white"></i>
                        </div>
                        <div class="min-w-0">
                            <h1 id="clientName" class="text-lg sm:text-xl font-bold text-white truncate">Loading...</h1>
                            <p id="clientMeta" class="text-xs sm:text-sm text-gray-400 truncate">Content Dashboard</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 sm:gap-4">
                        <select id="clientSelector" onchange="loadClient(this.value)" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm focus:outline-none truncate max-w-[200px]">
                            <option value="">Select Client</option>
                        </select>
                        <button onclick="refreshData()" class="p-2 glass rounded-lg text-gray-400 hover:text-white transition flex-shrink-0" title="Refresh">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button onclick="startTour()" class="p-2 glass rounded-lg text-gray-400 hover:text-white transition flex-shrink-0" title="Help Tour">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="stat-card glass rounded-xl p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center">
                            <i class="fas fa-file-alt text-white text-xl"></i>
                        </div>
                        <div>
                            <p id="statBlogs" class="text-2xl font-bold text-white">0</p>
                            <p class="text-sm text-gray-400">Blog Posts</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card glass rounded-xl p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center">
                            <i class="fas fa-share-alt text-white text-xl"></i>
                        </div>
                        <div>
                            <p id="statSocial" class="text-2xl font-bold text-white">0</p>
                            <p class="text-sm text-gray-400">Social Posts</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card glass rounded-xl p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center">
                            <i class="fas fa-key text-white text-xl"></i>
                        </div>
                        <div>
                            <p id="statKeywords" class="text-2xl font-bold text-white">0</p>
                            <p class="text-sm text-gray-400">Keywords</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card glass rounded-xl p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center">
                            <i class="fas fa-users text-white text-xl"></i>
                        </div>
                        <div>
                            <p id="statCompetitors" class="text-2xl font-bold text-white">0</p>
                            <p class="text-sm text-gray-400">Competitors</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="max-w-7xl mx-auto px-4 mb-6">
            <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-thin">
                <button onclick="showTab('generate')" id="tab-generate" class="px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium text-gray-400 hover:text-white transition whitespace-nowrap glass bg-gradient-to-r from-green-600 to-emerald-600 text-white">
                    <i class="fas fa-magic sm:mr-2"></i><span class="hidden sm:inline">Generate Content</span><span class="sm:hidden">Generate</span>
                </button>
                <button onclick="showTab('blogs')" id="tab-blogs" class="tab-active px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium transition whitespace-nowrap">
                    <i class="fas fa-file-alt sm:mr-2"></i><span class="hidden sm:inline">Blog Posts</span><span class="sm:hidden">Blogs</span>
                </button>
                <button onclick="showTab('social')" id="tab-social" class="px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium text-gray-400 hover:text-white transition whitespace-nowrap glass">
                    <i class="fas fa-share-alt sm:mr-2"></i><span class="hidden sm:inline">Social Posts</span><span class="sm:hidden">Social</span>
                </button>
                <button onclick="showTab('seo')" id="tab-seo" class="px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium text-gray-400 hover:text-white transition whitespace-nowrap glass">
                    <i class="fas fa-chart-line sm:mr-2"></i><span class="hidden sm:inline">SEO Overview</span><span class="sm:hidden">SEO</span>
                </button>
                <button onclick="showTab('calendar')" id="tab-calendar" class="px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium text-gray-400 hover:text-white transition whitespace-nowrap glass">
                    <i class="fas fa-calendar-alt sm:mr-2"></i><span class="hidden sm:inline">Calendar</span><span class="sm:hidden">Cal</span>
                </button>
                <button onclick="showTab('reports')" id="tab-reports" class="px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium text-gray-400 hover:text-white transition whitespace-nowrap glass">
                    <i class="fas fa-file-pdf sm:mr-2"></i><span class="hidden sm:inline">Reports</span><span class="sm:hidden">PDF</span>
                </button>
            </div>
        </div>

        <!-- Content Panels -->
        <div class="max-w-7xl mx-auto px-4 pb-12">
            <!-- Generate Panel -->
            <div id="panel-generate" class="hidden fade-in">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Blog Generation -->
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center">
                                <i class="fas fa-file-alt text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white">Generate Blog Post</h3>
                                <p class="text-sm text-gray-400">1,500 words with FAQs & internal links</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Select Keyword</label>
                                <select id="blogKeyword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-purple-500">
                                    <option value="">Choose a keyword...</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Or Enter Custom Keyword</label>
                                <input type="text" id="customBlogKeyword" placeholder="e.g., emergency AC repair" 
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-purple-500">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Word Count</label>
                                    <select id="blogWordCount" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-purple-500">
                                        <option value="1200">1,200 words</option>
                                        <option value="1500" selected>1,500 words</option>
                                        <option value="2000">2,000 words</option>
                                        <option value="2500">2,500 words</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Include FAQs</label>
                                    <select id="blogFaqs" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-purple-500">
                                        <option value="5" selected>5 FAQs</option>
                                        <option value="3">3 FAQs</option>
                                        <option value="0">No FAQs</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button onclick="generateBlog()" id="btnGenerateBlog" 
                                class="w-full py-4 bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl text-white font-bold hover:opacity-90 transition flex items-center justify-center gap-2">
                                <i class="fas fa-magic"></i> Generate Blog Post
                            </button>
                        </div>
                        
                        <div id="blogProgress" class="hidden mt-4 p-4 bg-white/5 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="spinner w-6 h-6"></div>
                                <span id="blogProgressText" class="text-gray-300">Generating...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Social Generation -->
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center">
                                <i class="fas fa-share-alt text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white">Generate Social Posts</h3>
                                <p class="text-sm text-gray-400">GBP, Facebook & Instagram</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Topic / Keyword</label>
                                <input type="text" id="socialTopic" placeholder="e.g., summer AC maintenance tips" 
                                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-purple-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Platforms</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition">
                                        <input type="checkbox" id="platformGbp" checked class="w-4 h-4 text-blue-600 rounded">
                                        <i class="fab fa-google text-blue-400"></i>
                                        <span class="text-sm text-white">GBP</span>
                                    </label>
                                    <label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition">
                                        <input type="checkbox" id="platformFacebook" checked class="w-4 h-4 text-blue-600 rounded">
                                        <i class="fab fa-facebook text-blue-500"></i>
                                        <span class="text-sm text-white">FB</span>
                                    </label>
                                    <label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition">
                                        <input type="checkbox" id="platformInstagram" checked class="w-4 h-4 text-pink-600 rounded">
                                        <i class="fab fa-instagram text-pink-500"></i>
                                        <span class="text-sm text-white">IG</span>
                                    </label>
                                </div>
                            </div>
                            
                            <button onclick="generateSocial()" id="btnGenerateSocial" 
                                class="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl text-white font-bold hover:opacity-90 transition flex items-center justify-center gap-2">
                                <i class="fas fa-magic"></i> Generate Social Posts
                            </button>
                        </div>
                        
                        <div id="socialProgress" class="hidden mt-4 p-4 bg-white/5 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="spinner w-6 h-6"></div>
                                <span id="socialProgressText" class="text-gray-300">Generating...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bulk Generation -->
                <div class="glass rounded-2xl p-6 mt-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center">
                            <i class="fas fa-layer-group text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-white">Bulk Generate</h3>
                            <p class="text-sm text-gray-400">Generate multiple posts at once</p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Blog Posts to Generate</label>
                            <select id="bulkBlogCount" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-purple-500">
                                <option value="0">0 blogs</option>
                                <option value="3">3 blogs</option>
                                <option value="5" selected>5 blogs</option>
                                <option value="10">10 blogs</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Social Posts Per Platform</label>
                            <select id="bulkSocialCount" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-purple-500">
                                <option value="0">0 social</option>
                                <option value="3">3 per platform</option>
                                <option value="5" selected>5 per platform</option>
                                <option value="10">10 per platform</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="generateBulk()" id="btnGenerateBulk" 
                                class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl text-white font-bold hover:opacity-90 transition flex items-center justify-center gap-2">
                                <i class="fas fa-rocket"></i> Generate All
                            </button>
                        </div>
                    </div>
                    
                    <div id="bulkProgress" class="hidden">
                        <div class="bg-white/5 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-300">Generating content...</span>
                                <span id="bulkProgressCount" class="text-purple-400 font-bold">0 / 0</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div id="bulkProgressBar" class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                            <div id="bulkProgressLog" class="mt-3 text-sm text-gray-400 max-h-32 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blogs Panel -->
            <div id="panel-blogs" class="fade-in">
                <div id="blogsList" class="space-y-4">
                    <div class="text-center py-12">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-gray-400">Loading blog posts...</p>
                    </div>
                </div>
            </div>

            <!-- Social Panel -->
            <div id="panel-social" class="hidden fade-in">
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <button onclick="filterSocial('all')" id="social-all" class="glass rounded-xl p-4 text-left hover:bg-white/5 transition border-2 border-purple-500">
                        <p class="text-white font-semibold">All Platforms</p>
                        <p id="countAll" class="text-2xl font-bold gradient-text">0</p>
                    </button>
                    <button onclick="filterSocial('gbp')" id="social-gbp" class="glass rounded-xl p-4 text-left hover:bg-white/5 transition">
                        <div class="flex items-center gap-2">
                            <i class="fab fa-google text-blue-400"></i>
                            <p class="text-white font-semibold">Google Business</p>
                        </div>
                        <p id="countGbp" class="text-2xl font-bold text-blue-400">0</p>
                    </button>
                    <button onclick="filterSocial('facebook')" id="social-facebook" class="glass rounded-xl p-4 text-left hover:bg-white/5 transition">
                        <div class="flex items-center gap-2">
                            <i class="fab fa-facebook text-blue-500"></i>
                            <p class="text-white font-semibold">Facebook</p>
                        </div>
                        <p id="countFacebook" class="text-2xl font-bold text-blue-500">0</p>
                    </button>
                </div>
                <div id="socialList" class="grid md:grid-cols-2 gap-4">
                    <div class="text-center py-12 col-span-2">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-gray-400">Loading social posts...</p>
                    </div>
                </div>
            </div>

            <!-- SEO Panel -->
            <div id="panel-seo" class="hidden fade-in">
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-bullseye mr-2 text-purple-400"></i>Target Keywords</h3>
                        <div id="keywordsList" class="space-y-2"></div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-crosshairs mr-2 text-orange-400"></i>Competitors</h3>
                        <div id="competitorsList" class="space-y-2"></div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-link mr-2 text-green-400"></i>Service Pages</h3>
                        <div id="servicePagesList" class="space-y-2"></div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-star mr-2 text-yellow-400"></i>Unique Selling Points</h3>
                        <div id="uspsList" class="space-y-2"></div>
                    </div>
                </div>
                
                <!-- Competitor Insights Section -->
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white"><i class="fas fa-chart-bar mr-2 text-cyan-400"></i>Competitor Insights</h3>
                        <a href="/elite" class="text-sm text-cyan-400 hover:text-cyan-300">
                            <i class="fas fa-external-link-alt mr-1"></i>Full Analysis
                        </a>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-400 border-b border-white/10">
                                    <th class="text-left py-3">Keyword</th>
                                    <th class="text-center py-3">Your Rank</th>
                                    <th class="text-center py-3">Top Competitor</th>
                                    <th class="text-center py-3">Gap</th>
                                </tr>
                            </thead>
                            <tbody id="competitorInsightsTable">
                                <tr>
                                    <td colspan="4" class="text-center py-6 text-gray-500">
                                        <i class="fas fa-chart-line text-3xl mb-2 block"></i>
                                        Loading competitor insights...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Calendar Panel -->
            <div id="panel-calendar" class="hidden fade-in">
                <div class="glass rounded-2xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <button onclick="changeMonth(-1)" class="p-2 glass rounded-lg hover:bg-white/10 transition">
                                <i class="fas fa-chevron-left text-white"></i>
                            </button>
                            <h2 id="calendarMonth" class="text-xl font-bold text-white">December 2024</h2>
                            <button onclick="changeMonth(1)" class="p-2 glass rounded-lg hover:bg-white/10 transition">
                                <i class="fas fa-chevron-right text-white"></i>
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="autoSchedule()" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-white text-sm font-medium hover:opacity-90 transition">
                                <i class="fas fa-magic mr-2"></i>Auto-Schedule
                            </button>
                        </div>
                    </div>
                    
                    <!-- Calendar Grid -->
                    <div class="grid grid-cols-7 gap-2 mb-4">
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Sun</div>
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Mon</div>
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Tue</div>
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Wed</div>
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Thu</div>
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Fri</div>
                        <div class="text-center text-gray-400 text-sm font-medium py-2">Sat</div>
                    </div>
                    <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                        <!-- Calendar days populated by JS -->
                    </div>
                    
                    <!-- Legend -->
                    <div class="flex items-center gap-6 mt-6 pt-4 border-t border-white/10">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                            <span class="text-sm text-gray-400">Blog Post</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                            <span class="text-sm text-gray-400">GBP Post</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-indigo-500"></div>
                            <span class="text-sm text-gray-400">Facebook</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-pink-500"></div>
                            <span class="text-sm text-gray-400">Instagram</span>
                        </div>
                    </div>
                </div>
                
                <!-- Scheduled Content List -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-list mr-2 text-purple-400"></i>Scheduled Content</h3>
                    <div id="scheduledList" class="space-y-3">
                        <p class="text-gray-500 text-sm">No content scheduled yet. Click "Auto-Schedule" to create a posting schedule.</p>
                    </div>
                </div>
            </div>
            
            <!-- Reports Panel -->
            <div id="panel-reports" class="hidden fade-in">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Monthly Report -->
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center">
                                <i class="fas fa-file-pdf text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white">Monthly Report</h3>
                                <p class="text-sm text-gray-400">Content performance summary</p>
                            </div>
                        </div>
                        <div class="space-y-3 mb-6">
                            <div class="flex items-center justify-between p-3 glass rounded-lg">
                                <span class="text-gray-400">Blog Posts Created</span>
                                <span id="reportBlogs" class="text-white font-bold">0</span>
                            </div>
                            <div class="flex items-center justify-between p-3 glass rounded-lg">
                                <span class="text-gray-400">Social Posts Created</span>
                                <span id="reportSocial" class="text-white font-bold">0</span>
                            </div>
                            <div class="flex items-center justify-between p-3 glass rounded-lg">
                                <span class="text-gray-400">Total Word Count</span>
                                <span id="reportWords" class="text-white font-bold">0</span>
                            </div>
                            <div class="flex items-center justify-between p-3 glass rounded-lg">
                                <span class="text-gray-400">Avg SEO Score</span>
                                <span id="reportSeoScore" class="text-white font-bold">--</span>
                            </div>
                        </div>
                        <button onclick="generateMonthlyReport()" class="w-full py-3 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl text-white font-semibold hover:opacity-90 transition">
                            <i class="fas fa-download mr-2"></i>Download PDF Report
                        </button>
                    </div>
                    
                    <!-- Content Inventory -->
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center">
                                <i class="fas fa-list-alt text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white">Content Inventory</h3>
                                <p class="text-sm text-gray-400">Export all content data</p>
                            </div>
                        </div>
                        <div class="space-y-3 mb-6">
                            <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer">
                                <input type="checkbox" id="exportBlogs" checked class="w-5 h-5 rounded">
                                <span class="text-white">Include Blog Posts</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer">
                                <input type="checkbox" id="exportSocial" checked class="w-5 h-5 rounded">
                                <span class="text-white">Include Social Posts</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 glass rounded-lg cursor-pointer">
                                <input type="checkbox" id="exportKeywords" checked class="w-5 h-5 rounded">
                                <span class="text-white">Include Keywords</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="exportInventoryCSV()" class="py-3 glass rounded-xl text-white font-semibold hover:bg-white/10 transition">
                                <i class="fas fa-file-csv mr-2"></i>CSV
                            </button>
                            <button onclick="exportInventoryHTML()" class="py-3 glass rounded-xl text-white font-semibold hover:bg-white/10 transition">
                                <i class="fas fa-file-code mr-2"></i>HTML
                            </button>
                        </div>
                    </div>
                    
                    <!-- Client Summary Card -->
                    <div class="glass rounded-2xl p-6 md:col-span-2">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center">
                                <i class="fas fa-chart-pie text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white">Client Summary</h3>
                                <p class="text-sm text-gray-400">One-page overview for client meetings</p>
                            </div>
                        </div>
                        <p class="text-gray-400 mb-4">Generate a professional one-page summary showing content created, keywords targeted, and next steps. Perfect for client review meetings.</p>
                        <button onclick="generateClientSummary()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl text-white font-semibold hover:opacity-90 transition">
                            <i class="fas fa-file-alt mr-2"></i>Generate Client Summary
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Blog Preview Modal -->
    <div id="blogModal" class="hidden fixed inset-0 bg-black/90 z-50 overflow-y-auto">
        <div class="max-w-4xl mx-auto py-8 px-4">
            <div class="glass-light rounded-2xl overflow-hidden fade-in">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-6">
                    <div class="flex items-start justify-between">
                        <div>
                            <span id="modalKeyword" class="inline-block px-3 py-1 bg-white/20 rounded-full text-white text-sm mb-2"></span>
                            <h1 id="modalTitle" class="text-2xl md:text-3xl font-bold text-white"></h1>
                        </div>
                        <button onclick="closeBlogModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                            <i class="fas fa-times text-white text-xl"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-4 mt-4 text-white/80 text-sm">
                        <span><i class="fas fa-clock mr-1"></i><span id="modalWordCount">0</span> words</span>
                        <span><i class="fas fa-link mr-1"></i><span id="modalLinkCount">0</span> internal links</span>
                        <span id="modalStatus" class="px-2 py-1 bg-white/20 rounded"></span>
                    </div>
                </div>
                <div class="p-6 md:p-8">
                    <!-- SEO Score Card -->
                    <div id="seoScoreCard" class="mb-6 p-4 bg-gradient-to-r from-slate-800 to-slate-900 rounded-xl text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-lg"><i class="fas fa-chart-line mr-2 text-green-400"></i>SEO Score</h3>
                            <div class="flex items-center gap-2">
                                <span id="seoScoreValue" class="text-3xl font-bold text-green-400">--</span>
                                <span class="text-gray-400">/100</span>
                            </div>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2 mb-4">
                            <div id="seoScoreBar" class="bg-gradient-to-r from-green-500 to-emerald-400 h-2 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                            <div id="seoWordCount" class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check-circle text-green-400"></i>
                                <span>Word Count</span>
                            </div>
                            <div id="seoKeywordDensity" class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check-circle text-green-400"></i>
                                <span>Keyword Density</span>
                            </div>
                            <div id="seoInternalLinks" class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check-circle text-green-400"></i>
                                <span>Internal Links</span>
                            </div>
                            <div id="seoMetaTitle" class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check-circle text-green-400"></i>
                                <span>Meta Title</span>
                            </div>
                            <div id="seoMetaDesc" class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check-circle text-green-400"></i>
                                <span>Meta Description</span>
                            </div>
                            <div id="seoHeadings" class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                                <i class="fas fa-check-circle text-green-400"></i>
                                <span>Heading Structure</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6 p-4 bg-gray-50 rounded-xl">
                        <p class="text-sm text-gray-500 mb-1">Meta Title</p>
                        <p id="modalMetaTitle" class="font-medium text-gray-800"></p>
                        <p class="text-sm text-gray-500 mt-3 mb-1">Meta Description</p>
                        <p id="modalMetaDesc" class="text-gray-600"></p>
                    </div>
                    <div id="modalBody" class="blog-content"></div>
                    <div id="modalFaq" class="mt-8 hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-question-circle mr-2 text-purple-500"></i>Frequently Asked Questions</h3>
                        <div id="faqContent" class="space-y-4"></div>
                    </div>
                </div>
                <div class="border-t p-4 flex justify-between items-center bg-gray-50">
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="copyBlogContent()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm font-medium transition">
                            <i class="fas fa-copy mr-1"></i>Copy
                        </button>
                        <button onclick="downloadBlog()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm font-medium transition">
                            <i class="fas fa-file-alt mr-1"></i>Markdown
                        </button>
                        <button onclick="downloadBlogHTML()" class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm font-medium transition">
                            <i class="fas fa-code mr-1"></i>HTML
                        </button>
                        <button onclick="downloadBlogWord()" class="px-4 py-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg text-sm font-medium transition">
                            <i class="fas fa-file-word mr-1"></i>Word
                        </button>
                    </div>
                    <button onclick="publishBlog()" class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg text-sm font-medium hover:opacity-90 transition">
                        <i class="fas fa-check mr-1"></i>Approve
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile navigation toggle
        function toggleMobileNav() {
            const nav = document.getElementById('mobileNav');
            nav.classList.toggle('hidden');
        }
        
        // ==========================================
        // WHITE-LABEL BRANDING
        // ==========================================
        function loadBranding() {
            const saved = localStorage.getItem('mcp_branding');
            if (!saved) return;
            
            try {
                const branding = JSON.parse(saved);
                
                // Update page title
                document.title = `Content Dashboard | ${branding.agencyName}`;
                
                // Update login screen branding
                const loginTitle = document.querySelector('.gradient-text');
                if (loginTitle) loginTitle.textContent = branding.agencyName;
                
                // Update any brand name elements
                document.querySelectorAll('[data-brand="name"]').forEach(el => {
                    el.textContent = branding.agencyName;
                });
                
                // Apply brand colors via CSS variables
                if (branding.primaryColor) {
                    document.documentElement.style.setProperty('--brand-primary', branding.primaryColor);
                }
                if (branding.secondaryColor) {
                    document.documentElement.style.setProperty('--brand-secondary', branding.secondaryColor);
                }
            } catch (e) {
                console.warn('Could not load branding:', e);
            }
        }
        
        // Load branding on page load
        document.addEventListener('DOMContentLoaded', loadBranding);
        
        let API_URL = window.location.origin;
        let AUTH_TOKEN = '';
        let currentClient = null;
        let allBlogs = [];
        let allSocial = [];

        // ==========================================
        // AUTH
        // ==========================================
        async function doLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('authError');

            try {
                const res = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (!res.ok) {
                    const errorText = await res.text();
                    try {
                        const errorData = JSON.parse(errorText);
                        throw new Error(errorData.error || `Login failed: ${res.status}`);
                    } catch {
                        throw new Error(`Server error: ${res.status}`);
                    }
                }
                
                const data = await res.json();

                if (data.token) {
                    AUTH_TOKEN = data.token;
                    document.getElementById('authModal').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    loadClients();
                } else {
                    errorEl.textContent = data.error || 'Login failed';
                    errorEl.classList.remove('hidden');
                }
            } catch (e) {
                errorEl.textContent = e.message || 'Connection failed';
                errorEl.classList.remove('hidden');
            }
        }

        // ==========================================
        // DATA LOADING
        // ==========================================
        async function loadClients() {
            try {
                const res = await fetch(`${API_URL}/api/clients/`, {
                    headers: { 'Authorization': `Bearer ${AUTH_TOKEN}` }
                });
                if (!res.ok) {
                    throw new Error(`Failed to load clients: ${res.status}`);
                }
                const data = await res.json();
                const clients = data.clients || [];

                const selector = document.getElementById('clientSelector');
                selector.innerHTML = '<option value="">Select Client</option>';
                clients.forEach(c => {
                    selector.innerHTML += `<option value="${c.id}">${c.business_name}</option>`;
                });

                if (clients.length > 0) {
                    selector.value = clients[0].id;
                    loadClient(clients[0].id);
                }
            } catch (e) {
                console.error('Failed to load clients:', e);
            }
        }

        async function loadClient(clientId) {
            if (!clientId) return;

            try {
                // Load client details
                const clientRes = await fetch(`${API_URL}/api/clients/${clientId}`, {
                    headers: { 'Authorization': `Bearer ${AUTH_TOKEN}` }
                });
                if (!clientRes.ok) {
                    throw new Error(`Failed to load client: ${clientRes.status}`);
                }
                currentClient = await clientRes.json();

                // Update header
                document.getElementById('clientName').textContent = currentClient.business_name || 'Client';
                document.getElementById('clientMeta').textContent = `${currentClient.industry || ''}  ${currentClient.geo || ''}`;

                // Load blogs
                const blogsRes = await fetch(`${API_URL}/api/content/client/${clientId}`, {
                    headers: { 'Authorization': `Bearer ${AUTH_TOKEN}` }
                });
                if (blogsRes.ok) {
                    const blogsData = await blogsRes.json();
                    allBlogs = blogsData.content || blogsData.blogs || [];
                } else {
                    allBlogs = [];
                }

                // Load social
                const socialRes = await fetch(`${API_URL}/api/social/client/${clientId}`, {
                    headers: { 'Authorization': `Bearer ${AUTH_TOKEN}` }
                });
                if (socialRes.ok) {
                    const socialData = await socialRes.json();
                    allSocial = socialData.posts || [];
                } else {
                    allSocial = [];
                }

                // Update stats
                updateStats();
                renderBlogs();
                renderSocial();
                renderSEO();

            } catch (e) {
                console.error('Failed to load client:', e);
                alert('Failed to load client data. Please try again.');
            }
        }

        function updateStats() {
            document.getElementById('statBlogs').textContent = allBlogs.length;
            document.getElementById('statSocial').textContent = allSocial.length;
            document.getElementById('statKeywords').textContent = 
                (currentClient?.primary_keywords?.length || 0) + (currentClient?.secondary_keywords?.length || 0);
            document.getElementById('statCompetitors').textContent = currentClient?.competitors?.length || 0;
        }

        function refreshData() {
            const clientId = document.getElementById('clientSelector').value;
            if (clientId) loadClient(clientId);
        }

        // ==========================================
        // TABS
        // ==========================================
        function showTab(tab) {
            ['generate', 'blogs', 'social', 'seo', 'calendar', 'reports'].forEach(t => {
                document.getElementById(`panel-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                if (t !== 'generate') {
                    document.getElementById(`tab-${t}`).classList.add('glass', 'text-gray-400');
                }
            });
            document.getElementById(`panel-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            if (tab !== 'generate') {
                document.getElementById(`tab-${tab}`).classList.remove('glass', 'text-gray-400');
            }
            
            // Populate keyword dropdown when generate tab is shown
            if (tab === 'generate') {
                populateKeywordDropdown();
            }
            
            // Render calendar when calendar tab is shown
            if (tab === 'calendar') {
                renderCalendar();
            }
            
            // Update report stats when reports tab is shown
            if (tab === 'reports') {
                updateReportStats();
            }
        }
        
        // ==========================================
        // CALENDAR
        // ==========================================
        let calendarDate = new Date();
        let scheduledContent = [];
        
        function changeMonth(delta) {
            calendarDate.setMonth(calendarDate.getMonth() + delta);
            renderCalendar();
        }
        
        function renderCalendar() {
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            
            // Update header
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day and days in month
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            // Build calendar grid
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div class="h-24 rounded-lg bg-white/5"></div>`;
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
                const dayContent = getScheduledForDate(dateStr);
                
                grid.innerHTML += `
                    <div class="h-24 rounded-lg ${isToday ? 'bg-purple-500/20 border border-purple-500' : 'bg-white/5 hover:bg-white/10'} p-2 transition cursor-pointer" onclick="showDateContent('${dateStr}')">
                        <div class="text-sm font-medium ${isToday ? 'text-purple-400' : 'text-gray-300'}">${day}</div>
                        <div class="mt-1 space-y-1 overflow-hidden">
                            ${dayContent}
                        </div>
                    </div>
                `;
            }
            
            // Update scheduled list
            renderScheduledList();
        }
        
        function getScheduledForDate(dateStr) {
            const items = scheduledContent.filter(c => c.scheduled_date === dateStr);
            if (items.length === 0) return '';
            
            return items.slice(0, 3).map(item => {
                const colors = {
                    blog: 'bg-green-500',
                    gbp: 'bg-blue-500',
                    facebook: 'bg-indigo-500',
                    instagram: 'bg-pink-500'
                };
                return `<div class="w-full h-1.5 rounded ${colors[item.type] || 'bg-gray-500'}" title="${item.title || item.topic}"></div>`;
            }).join('');
        }
        
        function renderScheduledList() {
            const container = document.getElementById('scheduledList');
            
            // Combine blogs and social posts with dates
            scheduledContent = [];
            
            // Add blogs
            allBlogs.forEach((blog, idx) => {
                const date = new Date();
                date.setDate(date.getDate() + (idx * 3)); // Every 3 days
                scheduledContent.push({
                    type: 'blog',
                    title: blog.title,
                    scheduled_date: date.toISOString().split('T')[0],
                    status: blog.status
                });
            });
            
            // Add social posts
            allSocial.forEach((post, idx) => {
                const date = new Date();
                date.setDate(date.getDate() + idx + 1); // Daily
                scheduledContent.push({
                    type: post.platform,
                    topic: post.topic || post.content?.substring(0, 50),
                    scheduled_date: date.toISOString().split('T')[0],
                    status: post.status
                });
            });
            
            // Sort by date
            scheduledContent.sort((a, b) => a.scheduled_date.localeCompare(b.scheduled_date));
            
            if (scheduledContent.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No content scheduled yet. Generate content first, then click "Auto-Schedule".</p>';
                return;
            }
            
            container.innerHTML = scheduledContent.slice(0, 10).map(item => {
                const colors = {
                    blog: 'from-green-500 to-emerald-600',
                    gbp: 'from-blue-500 to-cyan-600',
                    facebook: 'from-indigo-500 to-blue-600',
                    instagram: 'from-pink-500 to-rose-600'
                };
                const icons = {
                    blog: 'fa-file-alt',
                    gbp: 'fab fa-google',
                    facebook: 'fab fa-facebook',
                    instagram: 'fab fa-instagram'
                };
                return `
                    <div class="flex items-center gap-4 p-3 glass rounded-lg">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br ${colors[item.type] || 'from-gray-500 to-gray-600'} flex items-center justify-center">
                            <i class="${icons[item.type] || 'fas fa-file'} text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">${item.title || item.topic || 'Untitled'}</p>
                            <p class="text-gray-400 text-xs">${item.type.charAt(0).toUpperCase() + item.type.slice(1)}  ${formatDate(item.scheduled_date)}</p>
                        </div>
                        <span class="px-2 py-1 ${item.status === 'published' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'} rounded text-xs">
                            ${item.status || 'draft'}
                        </span>
                    </div>
                `;
            }).join('');
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }
        
        function autoSchedule() {
            // Auto-schedule unscheduled content
            const today = new Date();
            let blogDay = 0;
            let socialDay = 0;
            
            allBlogs.forEach((blog, idx) => {
                if (!blog.scheduled_date) {
                    const date = new Date(today);
                    date.setDate(date.getDate() + (blogDay * 3) + 1); // Blogs every 3 days
                    blog.scheduled_date = date.toISOString().split('T')[0];
                    blogDay++;
                }
            });
            
            allSocial.forEach((post, idx) => {
                if (!post.scheduled_date) {
                    const date = new Date(today);
                    date.setDate(date.getDate() + socialDay + 1); // Social daily
                    post.scheduled_date = date.toISOString().split('T')[0];
                    socialDay++;
                }
            });
            
            renderCalendar();
            alert(`Auto-scheduled ${allBlogs.length} blogs and ${allSocial.length} social posts!`);
        }
        
        function showDateContent(dateStr) {
            const items = scheduledContent.filter(c => c.scheduled_date === dateStr);
            if (items.length === 0) {
                alert(`No content scheduled for ${formatDate(dateStr)}`);
                return;
            }
            
            const content = items.map(i => ` ${i.type}: ${i.title || i.topic}`).join('\n');
            alert(`Content for ${formatDate(dateStr)}:\n\n${content}`);
        }

        // ==========================================
        // BLOGS
        // ==========================================
        function renderBlogs() {
            const container = document.getElementById('blogsList');

            if (allBlogs.length === 0) {
                container.innerHTML = `
                    <div class="glass rounded-xl p-12 text-center">
                        <i class="fas fa-file-alt text-4xl text-gray-600 mb-4"></i>
                        <p class="text-gray-400">No blog posts yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = allBlogs.map(blog => `
                <div class="content-card glass rounded-xl p-6 cursor-pointer hover:bg-white/5" onclick="openBlogModal('${blog.id}')">
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-purple-500/20 text-purple-300 rounded text-xs font-medium">
                                    ${blog.primary_keyword || 'Blog'}
                                </span>
                                <span class="px-2 py-1 ${blog.status === 'published' ? 'bg-green-500/20 text-green-300' : 'bg-yellow-500/20 text-yellow-300'} rounded text-xs">
                                    ${blog.status || 'draft'}
                                </span>
                            </div>
                            <h3 class="text-lg font-semibold text-white mb-2">${blog.title || 'Untitled'}</h3>
                            <p class="text-gray-400 text-sm line-clamp-2">${blog.meta_description || ''}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold gradient-text">${blog.word_count || 0}</p>
                            <p class="text-xs text-gray-500">words</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 mt-4 pt-4 border-t border-white/10 text-sm text-gray-500">
                        <span><i class="fas fa-link mr-1"></i>${countInternalLinks(blog.body)} links</span>
                        <span><i class="fas fa-question-circle mr-1"></i>${blog.faq_content?.length || 0} FAQs</span>
                        <span class="ml-auto text-purple-400 hover:text-purple-300">View Full Post </span>
                    </div>
                </div>
            `).join('');
        }

        function countInternalLinks(body) {
            if (!body) return 0;
            const matches = body.match(/<a[^>]*href=[^>]*>/gi);
            return matches ? matches.length : 0;
        }
        
        function calculateSEOScore(blog) {
            if (!blog) return { score: 0, checks: {} };
            
            const checks = {};
            let score = 0;
            
            // Word count (20 points) - target 1200+
            const wordCount = blog.word_count || 0;
            checks.wordCount = wordCount >= 1200;
            if (wordCount >= 1500) score += 20;
            else if (wordCount >= 1200) score += 15;
            else if (wordCount >= 800) score += 10;
            else if (wordCount >= 500) score += 5;
            
            // Keyword density (15 points) - target 1-2%
            const body = blog.body || '';
            const bodyText = body.replace(/<[^>]*>/g, '').toLowerCase();
            const keyword = (blog.primary_keyword || '').toLowerCase();
            if (keyword && bodyText) {
                const keywordCount = (bodyText.match(new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g')) || []).length;
                const totalWords = bodyText.split(/\s+/).filter(w => w.length > 0).length;
                const density = totalWords > 0 ? (keywordCount / totalWords) * 100 : 0;
                checks.keywordDensity = density >= 0.5 && density <= 3;
                if (density >= 1 && density <= 2) score += 15;
                else if (density >= 0.5 && density <= 3) score += 10;
                else if (density > 0) score += 5;
            } else {
                checks.keywordDensity = false;
            }
            
            // Internal links (15 points) - target 3+
            const linkCount = countInternalLinks(body);
            checks.internalLinks = linkCount >= 3;
            if (linkCount >= 5) score += 15;
            else if (linkCount >= 3) score += 12;
            else if (linkCount >= 1) score += 5;
            
            // Meta title (15 points) - target 50-60 chars with keyword
            const metaTitle = blog.meta_title || '';
            const titleLen = metaTitle.length;
            const titleHasKeyword = keyword && metaTitle.toLowerCase().includes(keyword);
            checks.metaTitle = titleLen >= 50 && titleLen <= 60 && titleHasKeyword;
            if (titleLen >= 50 && titleLen <= 60) score += 8;
            else if (titleLen >= 40 && titleLen <= 70) score += 5;
            if (titleHasKeyword) score += 7;
            
            // Meta description (15 points) - target 150-160 chars
            const metaDesc = blog.meta_description || '';
            const descLen = metaDesc.length;
            const descHasKeyword = keyword && metaDesc.toLowerCase().includes(keyword);
            checks.metaDesc = descLen >= 150 && descLen <= 160 && descHasKeyword;
            if (descLen >= 150 && descLen <= 160) score += 8;
            else if (descLen >= 120 && descLen <= 180) score += 5;
            if (descHasKeyword) score += 7;
            
            // Heading structure (20 points) - H2s and H3s with location
            const h2Count = (body.match(/<h2/gi) || []).length;
            const h3Count = (body.match(/<h3/gi) || []).length;
            checks.headings = h2Count >= 3 && h3Count >= 2;
            if (h2Count >= 4) score += 10;
            else if (h2Count >= 3) score += 8;
            else if (h2Count >= 2) score += 5;
            if (h3Count >= 3) score += 10;
            else if (h3Count >= 2) score += 8;
            else if (h3Count >= 1) score += 4;
            
            return { score: Math.min(100, score), checks };
        }
        
        function updateSEOScoreDisplay(seoResult) {
            const { score, checks } = seoResult;
            
            // Update score value and bar
            const scoreValueEl = document.getElementById('seoScoreValue');
            const scoreBarEl = document.getElementById('seoScoreBar');
            
            if (scoreValueEl) scoreValueEl.textContent = score;
            if (scoreBarEl) scoreBarEl.style.width = `${score}%`;
            
            // Update color based on score
            const scoreEl = document.getElementById('seoScoreValue');
            const barEl = document.getElementById('seoScoreBar');
            if (scoreEl && barEl) {
                if (score >= 80) {
                    scoreEl.className = 'text-3xl font-bold text-green-400';
                    barEl.className = 'bg-gradient-to-r from-green-500 to-emerald-400 h-2 rounded-full transition-all';
                } else if (score >= 60) {
                    scoreEl.className = 'text-3xl font-bold text-yellow-400';
                    barEl.className = 'bg-gradient-to-r from-yellow-500 to-orange-400 h-2 rounded-full transition-all';
                } else {
                    scoreEl.className = 'text-3xl font-bold text-red-400';
                    barEl.className = 'bg-gradient-to-r from-red-500 to-orange-400 h-2 rounded-full transition-all';
                }
            }
            
            // Update check indicators
            const updateCheck = (id, passed) => {
                const el = document.getElementById(id);
                if (!el) return;
                const icon = el.querySelector('i');
                if (!icon) return;
                if (passed) {
                    icon.className = 'fas fa-check-circle text-green-400';
                } else {
                    icon.className = 'fas fa-times-circle text-red-400';
                }
            };
            
            updateCheck('seoWordCount', checks.wordCount);
            updateCheck('seoKeywordDensity', checks.keywordDensity);
            updateCheck('seoInternalLinks', checks.internalLinks);
            updateCheck('seoMetaTitle', checks.metaTitle);
            updateCheck('seoMetaDesc', checks.metaDesc);
            updateCheck('seoHeadings', checks.headings);
        }

        let currentBlog = null;

        function openBlogModal(blogId) {
            currentBlog = allBlogs.find(b => b.id === blogId);
            if (!currentBlog) return;

            document.getElementById('modalKeyword').textContent = currentBlog.primary_keyword || '';
            document.getElementById('modalTitle').textContent = currentBlog.title || 'Untitled';
            document.getElementById('modalWordCount').textContent = currentBlog.word_count || 0;
            document.getElementById('modalLinkCount').textContent = countInternalLinks(currentBlog.body);
            document.getElementById('modalStatus').textContent = currentBlog.status || 'draft';
            document.getElementById('modalMetaTitle').textContent = currentBlog.meta_title || '';
            document.getElementById('modalMetaDesc').textContent = currentBlog.meta_description || '';
            document.getElementById('modalBody').innerHTML = currentBlog.body || '';
            
            // Calculate and display SEO score
            const seoResult = calculateSEOScore(currentBlog);
            updateSEOScoreDisplay(seoResult);

            // FAQs
            const faqSection = document.getElementById('modalFaq');
            const faqContent = document.getElementById('faqContent');
            if (currentBlog.faq_content && currentBlog.faq_content.length > 0) {
                faqSection.classList.remove('hidden');
                faqContent.innerHTML = currentBlog.faq_content.map(faq => `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="font-semibold text-gray-800 mb-2">${faq.question || faq.q || ''}</p>
                        <p class="text-gray-600">${faq.answer || faq.a || ''}</p>
                    </div>
                `).join('');
            } else {
                faqSection.classList.add('hidden');
            }

            document.getElementById('blogModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeBlogModal() {
            document.getElementById('blogModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function copyBlogContent() {
            if (!currentBlog) return;
            const content = `${currentBlog.title}\n\n${currentBlog.body?.replace(/<[^>]*>/g, '')}`;
            navigator.clipboard.writeText(content);
            alert('Content copied to clipboard!');
        }

        function downloadBlog() {
            if (!currentBlog) return;
            const content = `# ${currentBlog.title}\n\n${currentBlog.body?.replace(/<[^>]*>/g, '')}`;
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBlog.title?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'blog'}.md`;
            a.click();
        }
        
        // Helper to escape HTML attributes
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;')
                     .replace(/</g, '&lt;')
                     .replace(/>/g, '&gt;')
                     .replace(/"/g, '&quot;')
                     .replace(/'/g, '&#39;');
        }
        
        function downloadBlogHTML() {
            if (!currentBlog) return;
            
            const safeTitle = escapeHtml(currentBlog.meta_title || currentBlog.title);
            const safeDesc = escapeHtml(currentBlog.meta_description || '');
            
            const html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${safeTitle}</title>
    <meta name="description" content="${safeDesc}">
    <style>
        body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; line-height: 1.6; color: #333; }
        h1 { color: #1a1a1a; margin-bottom: 0.5rem; }
        h2 { color: #2a2a2a; margin-top: 2rem; }
        h3 { color: #3a3a3a; margin-top: 1.5rem; }
        a { color: #6366f1; }
        .meta { color: #666; font-size: 0.9rem; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
        .faq { background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-top: 2rem; }
        .faq h3 { margin-top: 0; }
        .faq-item { margin-bottom: 1rem; }
        .faq-q { font-weight: 600; color: #1a1a1a; }
        .faq-a { color: #4a4a4a; margin-top: 0.25rem; }
    </style>
</head>
<body>
    <article>
        <h1>${currentBlog.title}</h1>
        <div class="meta">
            <strong>Keyword:</strong> ${escapeHtml(currentBlog.primary_keyword || '')} | 
            <strong>Words:</strong> ${currentBlog.word_count || 0}
        </div>
        ${currentBlog.body || ''}
        ${currentBlog.faq_content?.length > 0 ? `
        <div class="faq">
            <h3>Frequently Asked Questions</h3>
            ${currentBlog.faq_content.map(faq => `
            <div class="faq-item">
                <p class="faq-q">${escapeHtml(faq.question || faq.q)}</p>
                <p class="faq-a">${escapeHtml(faq.answer || faq.a)}</p>
            </div>
            `).join('')}
        </div>
        ` : ''}
    </article>
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBlog.title?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'blog'}.html`;
            a.click();
        }
        
        function downloadBlogWord() {
            if (!currentBlog) return;
            
            // Create Word-compatible HTML
            const safeTitle = escapeHtml(currentBlog.title);
            const safeKeyword = escapeHtml(currentBlog.primary_keyword || '');
            const safeMetaTitle = escapeHtml(currentBlog.meta_title || '');
            const safeMetaDesc = escapeHtml(currentBlog.meta_description || '');
            
            const wordDoc = `
<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
<head>
    <meta charset="UTF-8">
    <title>${safeTitle}</title>
    <style>
        body { font-family: Calibri, sans-serif; font-size: 11pt; line-height: 1.5; }
        h1 { font-size: 24pt; color: #1a1a1a; margin-bottom: 12pt; }
        h2 { font-size: 16pt; color: #2a2a2a; margin-top: 18pt; margin-bottom: 6pt; }
        h3 { font-size: 13pt; color: #3a3a3a; margin-top: 12pt; margin-bottom: 6pt; }
        p { margin-bottom: 10pt; }
        a { color: #0563C1; }
        .meta { color: #666; font-size: 10pt; border-bottom: 1pt solid #ccc; padding-bottom: 12pt; margin-bottom: 18pt; }
        .faq { background: #f5f5f5; padding: 12pt; margin-top: 24pt; }
        .faq-q { font-weight: bold; margin-bottom: 3pt; }
        .faq-a { margin-bottom: 12pt; color: #444; }
    </style>
</head>
<body>
    <h1>${safeTitle}</h1>
    <div class="meta">
        <b>Target Keyword:</b> ${safeKeyword}<br>
        <b>Meta Title:</b> ${safeMetaTitle}<br>
        <b>Meta Description:</b> ${safeMetaDesc}<br>
        <b>Word Count:</b> ${currentBlog.word_count || 0}
    </div>
    ${currentBlog.body || ''}
    ${currentBlog.faq_content?.length > 0 ? `
    <div class="faq">
        <h2>Frequently Asked Questions</h2>
        ${currentBlog.faq_content.map(faq => `
        <p class="faq-q">${escapeHtml(faq.question || faq.q)}</p>
        <p class="faq-a">${escapeHtml(faq.answer || faq.a)}</p>
        `).join('')}
    </div>
    ` : ''}
</body>
</html>`;
            
            const blob = new Blob([wordDoc], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBlog.title?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'blog'}.doc`;
            a.click();
        }
        
        function publishBlog() {
            if (!currentBlog) return;
            alert('Blog approved! In a full implementation, this would publish to WordPress or update the status.');
        }

        // ==========================================
        // SOCIAL
        // ==========================================
        let socialFilter = 'all';

        function renderSocial() {
            const container = document.getElementById('socialList');

            // Update counts
            document.getElementById('countAll').textContent = allSocial.length;
            document.getElementById('countGbp').textContent = allSocial.filter(s => s.platform === 'gbp').length;
            document.getElementById('countFacebook').textContent = allSocial.filter(s => s.platform === 'facebook').length;

            const filtered = socialFilter === 'all' ? allSocial : allSocial.filter(s => s.platform === socialFilter);

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="glass rounded-xl p-12 text-center col-span-2">
                        <i class="fas fa-share-alt text-4xl text-gray-600 mb-4"></i>
                        <p class="text-gray-400">No social posts yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(post => `
                <div class="glass rounded-xl p-4 social-${post.platform}">
                    <div class="flex items-center gap-2 mb-3">
                        ${getPlatformIcon(post.platform)}
                        <span class="text-sm font-medium text-white">${getPlatformName(post.platform)}</span>
                        <span class="ml-auto px-2 py-1 ${post.status === 'published' ? 'bg-green-500/20 text-green-300' : 'bg-yellow-500/20 text-yellow-300'} rounded text-xs">
                            ${post.status || 'draft'}
                        </span>
                    </div>
                    <p class="text-gray-300 text-sm mb-3">${post.content || ''}</p>
                    ${post.hashtags?.length > 0 ? `
                        <div class="flex flex-wrap gap-1">
                            ${post.hashtags.map(h => `<span class="text-xs text-purple-400">#${h}</span>`).join(' ')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function filterSocial(filter) {
            socialFilter = filter;
            ['all', 'gbp', 'facebook'].forEach(f => {
                document.getElementById(`social-${f}`).classList.remove('border-2', 'border-purple-500');
            });
            document.getElementById(`social-${filter}`).classList.add('border-2', 'border-purple-500');
            renderSocial();
        }

        function getPlatformIcon(platform) {
            const icons = {
                'gbp': '<i class="fab fa-google text-blue-400"></i>',
                'facebook': '<i class="fab fa-facebook text-blue-500"></i>',
                'instagram': '<i class="fab fa-instagram text-pink-500"></i>'
            };
            return icons[platform] || '<i class="fas fa-share-alt text-gray-400"></i>';
        }

        function getPlatformName(platform) {
            const names = { 'gbp': 'Google Business', 'facebook': 'Facebook', 'instagram': 'Instagram' };
            return names[platform] || platform;
        }

        // ==========================================
        // SEO
        // ==========================================
        function renderSEO() {
            // Keywords
            const keywordsEl = document.getElementById('keywordsList');
            const allKeywords = [...(currentClient?.primary_keywords || []), ...(currentClient?.secondary_keywords || [])];
            keywordsEl.innerHTML = allKeywords.length > 0 
                ? allKeywords.map((k, i) => `
                    <div class="flex items-center gap-2 p-2 rounded-lg ${i < (currentClient?.primary_keywords?.length || 0) ? 'bg-purple-500/20' : 'bg-white/5'}">
                        <span class="text-sm text-gray-300">${k}</span>
                        ${i < (currentClient?.primary_keywords?.length || 0) ? '<span class="ml-auto text-xs text-purple-400">Primary</span>' : ''}
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-sm">No keywords defined</p>';

            // Competitors
            const compsEl = document.getElementById('competitorsList');
            compsEl.innerHTML = currentClient?.competitors?.length > 0
                ? currentClient.competitors.map(c => `
                    <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                        <i class="fas fa-globe text-orange-400"></i>
                        <span class="text-sm text-gray-300">${c}</span>
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-sm">No competitors defined</p>';

            // Service Pages
            const servicesEl = document.getElementById('servicePagesList');
            servicesEl.innerHTML = currentClient?.service_pages?.length > 0
                ? currentClient.service_pages.map(s => `
                    <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                        <i class="fas fa-link text-green-400"></i>
                        <div class="flex-1">
                            <span class="text-sm text-gray-300">${s.title || s.keyword}</span>
                            <span class="text-xs text-gray-500 block">${s.url}</span>
                        </div>
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-sm">No service pages defined</p>';

            // USPs
            const uspsEl = document.getElementById('uspsList');
            uspsEl.innerHTML = currentClient?.unique_selling_points?.length > 0
                ? currentClient.unique_selling_points.map(u => `
                    <div class="flex items-center gap-2 p-2 rounded-lg bg-white/5">
                        <i class="fas fa-star text-yellow-400"></i>
                        <span class="text-sm text-gray-300">${u}</span>
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-sm">No USPs defined</p>';
            
            // Load competitor insights
            loadCompetitorInsights();
        }
        
        async function loadCompetitorInsights() {
            const table = document.getElementById('competitorInsightsTable');
            if (!table) return;
            
            if (!currentClient) {
                table.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Select a client to view insights</td></tr>';
                return;
            }
            
            // Generate sample insights based on client keywords
            const keywords = currentClient.primary_keywords || [];
            const geo = currentClient.geo || '';
            
            if (keywords.length === 0) {
                table.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">No keywords to analyze</td></tr>';
                return;
            }
            
            // Simulate competitor data
            const insights = keywords.slice(0, 5).map((kw, i) => {
                const yourRank = Math.random() > 0.3 ? Math.floor(Math.random() * 20) + 1 : null;
                const compRank = Math.floor(Math.random() * 10) + 1;
                const gap = yourRank ? yourRank - compRank : null;
                
                return {
                    keyword: `${kw || ''} ${geo}`.trim(),
                    yourRank,
                    compRank,
                    gap
                };
            });
            
            table.innerHTML = insights.map(item => {
                const rankClass = (rank) => {
                    if (!rank) return 'text-red-400';
                    if (rank <= 3) return 'text-green-400';
                    if (rank <= 10) return 'text-blue-400';
                    return 'text-yellow-400';
                };
                
                const gapDisplay = item.gap === null ? '<span class="text-red-400">Not ranking</span>' :
                    item.gap > 0 ? `<span class="text-red-400">-${item.gap} behind</span>` :
                    item.gap < 0 ? `<span class="text-green-400">+${Math.abs(item.gap)} ahead</span>` :
                    '<span class="text-gray-400">Tied</span>';
                
                return `
                    <tr class="border-b border-white/5 hover:bg-white/5">
                        <td class="py-3 text-white">${escapeHtml(item.keyword)}</td>
                        <td class="py-3 text-center ${rankClass(item.yourRank)} font-bold">${item.yourRank ? '#' + item.yourRank : ''}</td>
                        <td class="py-3 text-center ${rankClass(item.compRank)}">#${item.compRank}</td>
                        <td class="py-3 text-center">${gapDisplay}</td>
                    </tr>
                `;
            }).join('');
        }

        // ==========================================
        // CONTENT GENERATION
        // ==========================================
        
        function populateKeywordDropdown() {
            const select = document.getElementById('blogKeyword');
            if (!currentClient) return;
            
            select.innerHTML = '<option value="">Choose a keyword...</option>';
            
            // Add primary keywords
            if (currentClient.primary_keywords?.length > 0) {
                const primaryGroup = document.createElement('optgroup');
                primaryGroup.label = ' Primary Keywords';
                currentClient.primary_keywords.forEach(kw => {
                    const option = document.createElement('option');
                    option.value = kw;
                    option.textContent = kw;
                    primaryGroup.appendChild(option);
                });
                select.appendChild(primaryGroup);
            }
            
            // Add secondary keywords
            if (currentClient.secondary_keywords?.length > 0) {
                const secondaryGroup = document.createElement('optgroup');
                secondaryGroup.label = ' Secondary Keywords';
                currentClient.secondary_keywords.forEach(kw => {
                    const option = document.createElement('option');
                    option.value = kw;
                    option.textContent = kw;
                    secondaryGroup.appendChild(option);
                });
                select.appendChild(secondaryGroup);
            }
        }
        
        async function generateBlog() {
            const keyword = document.getElementById('customBlogKeyword').value.trim() || 
                           document.getElementById('blogKeyword').value;
            
            if (!keyword) {
                alert('Please select or enter a keyword');
                return;
            }
            
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            const wordCount = parseInt(document.getElementById('blogWordCount').value);
            const faqCount = parseInt(document.getElementById('blogFaqs').value);
            
            const btn = document.getElementById('btnGenerateBlog');
            const progress = document.getElementById('blogProgress');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner w-5 h-5 mr-2"></div> Generating...';
            progress.classList.remove('hidden');
            document.getElementById('blogProgressText').textContent = 'Generating 1,500+ word SEO blog post...';
            
            try {
                const response = await fetch('/api/content/blog/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AUTH_TOKEN}`
                    },
                    body: JSON.stringify({
                        client_id: currentClient.id,
                        keyword: keyword,
                        word_count: wordCount,
                        include_faq: faqCount > 0,
                        faq_count: faqCount,
                        generate_schema: true
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    throw new Error(errorData.error || `Server error: ${response.status}`);
                }
                
                const result = await response.json();
                
                document.getElementById('blogProgressText').textContent = ' Blog post generated successfully!';
                
                // Refresh the blogs list
                setTimeout(() => {
                    progress.classList.add('hidden');
                    loadClient(currentClient.id);
                    showTab('blogs');
                    alert(`Blog post "${result.title || keyword}" generated successfully!`);
                }, 1500);
                
            } catch (error) {
                console.error('Blog generation error:', error);
                document.getElementById('blogProgressText').textContent = `Error: ${error.message}`;
                alert(`Failed to generate blog: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> Generate Blog Post';
            }
        }
        
        async function generateSocial() {
            const topic = document.getElementById('socialTopic').value.trim();
            
            if (!topic) {
                alert('Please enter a topic');
                return;
            }
            
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            const platforms = [];
            if (document.getElementById('platformGbp').checked) platforms.push('gbp');
            if (document.getElementById('platformFacebook').checked) platforms.push('facebook');
            if (document.getElementById('platformInstagram').checked) platforms.push('instagram');
            
            if (platforms.length === 0) {
                alert('Please select at least one platform');
                return;
            }
            
            const btn = document.getElementById('btnGenerateSocial');
            const progress = document.getElementById('socialProgress');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner w-5 h-5 mr-2"></div> Generating...';
            progress.classList.remove('hidden');
            
            let generated = 0;
            
            for (const platform of platforms) {
                document.getElementById('socialProgressText').textContent = `Generating ${platform.toUpperCase()} post...`;
                
                try {
                    await fetch('/api/content/social/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${AUTH_TOKEN}`
                        },
                        body: JSON.stringify({
                            client_id: currentClient.id,
                            topic: topic,
                            platform: platform
                        })
                    });
                    generated++;
                } catch (error) {
                    console.error(`Social generation error (${platform}):`, error);
                }
            }
            
            document.getElementById('socialProgressText').textContent = ` Generated ${generated} social posts!`;
            
            setTimeout(() => {
                progress.classList.add('hidden');
                loadClient(currentClient.id);
                showTab('social');
            }, 1500);
            
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-magic"></i> Generate Social Posts';
        }
        
        async function generateBulk() {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            const blogCount = parseInt(document.getElementById('bulkBlogCount').value);
            const socialCount = parseInt(document.getElementById('bulkSocialCount').value);
            
            if (blogCount === 0 && socialCount === 0) {
                alert('Please select at least one item to generate');
                return;
            }
            
            // Check if client has keywords
            const availableKeywords = [
                ...(currentClient.primary_keywords || []),
                ...(currentClient.secondary_keywords || [])
            ];
            
            if (blogCount > 0 && availableKeywords.length === 0) {
                alert('This client has no keywords defined. Please add keywords first or use the single blog generator with a custom keyword.');
                return;
            }
            
            if (blogCount > availableKeywords.length) {
                if (!confirm(`This client only has ${availableKeywords.length} keyword(s). Generate ${availableKeywords.length} blogs instead of ${blogCount}?`)) {
                    return;
                }
            }
            
            const btn = document.getElementById('btnGenerateBulk');
            const progress = document.getElementById('bulkProgress');
            const progressBar = document.getElementById('bulkProgressBar');
            const progressCount = document.getElementById('bulkProgressCount');
            const progressLog = document.getElementById('bulkProgressLog');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner w-5 h-5 mr-2"></div> Generating...';
            progress.classList.remove('hidden');
            progressLog.innerHTML = '';
            
            const actualBlogCount = Math.min(blogCount, availableKeywords.length);
            const actualSocialTopics = Math.min(socialCount, availableKeywords.length);
            const totalItems = actualBlogCount + (actualSocialTopics * 3); // 3 platforms
            let completed = 0;
            
            // Get keywords for blogs
            const keywords = availableKeywords.slice(0, actualBlogCount);
            
            // Generate blogs
            for (let i = 0; i < keywords.length; i++) {
                const keyword = keywords[i];
                progressLog.innerHTML += `<div class="text-blue-400"> Generating blog: ${keyword}...</div>`;
                progressLog.scrollTop = progressLog.scrollHeight;
                
                try {
                    const response = await fetch('/api/content/blog/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${AUTH_TOKEN}`
                        },
                        body: JSON.stringify({
                            client_id: currentClient.id,
                            keyword: keyword,
                            word_count: 1500,
                            include_faq: true,
                            faq_count: 5,
                            generate_schema: true
                        })
                    });
                    
                    if (response.ok) {
                        progressLog.innerHTML += `<div class="text-green-400"> Blog: ${keyword}</div>`;
                    } else {
                        progressLog.innerHTML += `<div class="text-red-400"> Failed: ${keyword}</div>`;
                    }
                } catch (error) {
                    progressLog.innerHTML += `<div class="text-red-400"> Error: ${keyword}</div>`;
                }
                
                completed++;
                progressCount.textContent = `${completed} / ${totalItems}`;
                progressBar.style.width = totalItems > 0 ? `${(completed / totalItems) * 100}%` : '100%';
            }
            
            // Generate social posts
            const platforms = ['gbp', 'facebook', 'instagram'];
            const topics = availableKeywords.slice(0, socialCount);
            
            if (socialCount > 0 && topics.length === 0) {
                progressLog.innerHTML += `<div class="text-yellow-400"> No keywords for social posts - skipping</div>`;
            }
            
            for (const topic of topics) {
                for (const platform of platforms) {
                    progressLog.innerHTML += `<div class="text-blue-400"> Generating ${platform}: ${topic}...</div>`;
                    progressLog.scrollTop = progressLog.scrollHeight;
                    
                    try {
                        await fetch('/api/content/social/generate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${AUTH_TOKEN}`
                            },
                            body: JSON.stringify({
                                client_id: currentClient.id,
                                topic: topic,
                                platform: platform
                            })
                        });
                        progressLog.innerHTML += `<div class="text-green-400"> ${platform}: ${topic}</div>`;
                    } catch (error) {
                        progressLog.innerHTML += `<div class="text-red-400"> ${platform}: ${topic}</div>`;
                    }
                    
                    completed++;
                    progressCount.textContent = `${completed} / ${totalItems}`;
                    progressBar.style.width = totalItems > 0 ? `${(completed / totalItems) * 100}%` : '100%';
                }
            }
            
            progressLog.innerHTML += `<div class="text-purple-400 font-bold mt-2"> Bulk generation complete!</div>`;
            
            setTimeout(() => {
                loadClient(currentClient.id);
                showTab('blogs');
            }, 2000);
            
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-rocket"></i> Generate All';
        }

        // Close modal on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeBlogModal();
        });
        
        // ==========================================
        // ONBOARDING TOUR
        // ==========================================
        const tourSteps = [
            {
                element: '#tab-generate',
                title: 'Generate Content',
                content: 'Click here to create new blog posts and social media content with AI. Select a keyword and click generate!',
                position: 'bottom'
            },
            {
                element: '#tab-blogs',
                title: 'Blog Posts',
                content: 'View all your generated blog posts here. Click any post to preview, edit, or export it.',
                position: 'bottom'
            },
            {
                element: '#tab-social',
                title: 'Social Media',
                content: 'Manage your social media content for Google Business, Facebook, and Instagram.',
                position: 'bottom'
            },
            {
                element: '#tab-calendar',
                title: 'Content Calendar',
                content: 'Plan and schedule your content. Use Auto-Schedule to create a posting plan automatically.',
                position: 'bottom'
            },
            {
                element: '#clientSelector',
                title: 'Switch Clients',
                content: 'Use this dropdown to switch between different client accounts.',
                position: 'bottom'
            }
        ];
        
        let currentTourStep = 0;
        let tourActive = false;
        
        function startTour() {
            if (tourSteps.length === 0) return;
            tourActive = true;
            currentTourStep = 0;
            showTourStep(0);
        }
        
        function showTourStep(index) {
            // Remove any existing tour elements
            document.querySelectorAll('.tour-tooltip, .tour-highlight').forEach(el => el.remove());
            
            if (index >= tourSteps.length) {
                endTour();
                return;
            }
            
            const step = tourSteps[index];
            const element = document.querySelector(step.element);
            
            if (!element) {
                // Skip to next step if element not found
                showTourStep(index + 1);
                return;
            }
            
            // Add highlight
            element.classList.add('tour-highlight');
            
            // Create tooltip
            const tooltip = document.createElement('div');
            tooltip.className = `tour-tooltip ${step.position}`;
            tooltip.innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                        <i class="fas fa-lightbulb text-purple-600"></i>
                    </div>
                    <h3 class="font-bold text-gray-900">${step.title}</h3>
                </div>
                <p class="text-gray-600 text-sm mb-4">${step.content}</p>
                <div class="flex items-center justify-between">
                    <div class="tour-progress">
                        ${tourSteps.map((_, i) => `<div class="tour-progress-dot ${i === index ? 'active' : ''}"></div>`).join('')}
                    </div>
                    <div class="flex gap-2">
                        <button onclick="endTour()" class="px-3 py-1 text-gray-500 text-sm hover:text-gray-700">Skip</button>
                        <button onclick="nextTourStep()" class="px-4 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700">
                            ${index === tourSteps.length - 1 ? 'Finish' : 'Next'}
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(tooltip);
            
            // Position tooltip
            const rect = element.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let top, left;
            switch (step.position) {
                case 'bottom':
                    top = rect.bottom + 16;
                    left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                    break;
                case 'top':
                    top = rect.top - tooltipRect.height - 16;
                    left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                    break;
                case 'left':
                    top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
                    left = rect.left - tooltipRect.width - 16;
                    break;
                case 'right':
                    top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
                    left = rect.right + 16;
                    break;
            }
            
            // Keep tooltip in viewport
            left = Math.max(16, Math.min(left, window.innerWidth - tooltipRect.width - 16));
            top = Math.max(16, Math.min(top, window.innerHeight - tooltipRect.height - 16));
            
            tooltip.style.top = `${top}px`;
            tooltip.style.left = `${left}px`;
        }
        
        function nextTourStep() {
            const currentElement = document.querySelector(tourSteps[currentTourStep]?.element);
            if (currentElement) currentElement.classList.remove('tour-highlight');
            
            currentTourStep++;
            if (currentTourStep >= tourSteps.length) {
                endTour();
            } else {
                showTourStep(currentTourStep);
            }
        }
        
        function endTour() {
            tourActive = false;
            document.querySelectorAll('.tour-tooltip, .tour-highlight').forEach(el => {
                if (el.classList.contains('tour-highlight')) {
                    el.classList.remove('tour-highlight');
                } else {
                    el.remove();
                }
            });
            
            // Mark tour as completed
            localStorage.setItem('mcp_tour_completed', 'true');
        }
        
        // Show tour for first-time users
        // ==========================================
        // REPORTS
        // ==========================================
        function updateReportStats() {
            if (!currentClient) return;
            
            document.getElementById('reportBlogs').textContent = allBlogs.length;
            document.getElementById('reportSocial').textContent = allSocial.length;
            
            const totalWords = allBlogs.reduce((sum, b) => sum + (b.word_count || 0), 0);
            document.getElementById('reportWords').textContent = totalWords.toLocaleString();
            
            // Calculate average SEO score
            if (allBlogs.length > 0) {
                const scores = allBlogs.map(b => calculateSEOScore(b).score);
                const avgScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
                document.getElementById('reportSeoScore').textContent = avgScore + '/100';
            } else {
                document.getElementById('reportSeoScore').textContent = '--';
            }
        }
        
        function generateMonthlyReport() {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            const branding = JSON.parse(localStorage.getItem('mcp_branding') || '{}');
            const agencyName = branding.agencyName || 'MCP Framework';
            const totalWords = allBlogs.reduce((sum, b) => sum + (b.word_count || 0), 0);
            const avgScore = allBlogs.length > 0 
                ? Math.round(allBlogs.map(b => calculateSEOScore(b).score).reduce((a, b) => a + b, 0) / allBlogs.length)
                : 0;
            
            const reportHTML = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Monthly Content Report - ${currentClient.business_name}</title>
    <style>
        @page { margin: 0.5in; }
        body { font-family: Arial, sans-serif; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; }
        .header h1 { margin: 0 0 10px 0; font-size: 24px; }
        .header p { margin: 0; opacity: 0.9; }
        .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; }
        .stat-box h3 { margin: 0; font-size: 36px; color: #667eea; }
        .stat-box p { margin: 5px 0 0 0; color: #64748b; }
        .section { margin-bottom: 30px; }
        .section h2 { color: #1e293b; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        .content-list { list-style: none; padding: 0; }
        .content-list li { padding: 12px; background: #f8fafc; margin-bottom: 8px; border-radius: 8px; border-left: 4px solid #667eea; }
        .footer { text-align: center; color: #94a3b8; font-size: 12px; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Monthly Content Report</h1>
        <p>${currentClient.business_name}  ${new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</p>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            <h3>${allBlogs.length}</h3>
            <p>Blog Posts Created</p>
        </div>
        <div class="stat-box">
            <h3>${allSocial.length}</h3>
            <p>Social Posts Created</p>
        </div>
        <div class="stat-box">
            <h3>${totalWords.toLocaleString()}</h3>
            <p>Total Words Written</p>
        </div>
        <div class="stat-box">
            <h3>${avgScore}/100</h3>
            <p>Average SEO Score</p>
        </div>
    </div>
    
    <div class="section">
        <h2>Blog Posts</h2>
        <ul class="content-list">
            ${allBlogs.slice(0, 10).map(b => `<li><strong>${b.title || 'Untitled'}</strong> - ${b.word_count || 0} words - ${b.status || 'draft'}</li>`).join('')}
            ${allBlogs.length > 10 ? `<li><em>...and ${allBlogs.length - 10} more</em></li>` : ''}
            ${allBlogs.length === 0 ? '<li>No blog posts yet</li>' : ''}
        </ul>
    </div>
    
    <div class="section">
        <h2>Keywords Targeted</h2>
        <ul class="content-list">
            ${(currentClient.primary_keywords || []).slice(0, 10).map(k => `<li>${k}</li>`).join('')}
            ${(currentClient.primary_keywords || []).length === 0 ? '<li>No keywords defined</li>' : ''}
        </ul>
    </div>
    
    <div class="footer">
        <p>Generated by ${agencyName}  ${new Date().toLocaleString()}</p>
    </div>
</body>
</html>`;
            
            const blob = new Blob([reportHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentClient.business_name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'client'}-monthly-report.html`;
            a.click();
            
            alert('Report downloaded! Open it in a browser and print to PDF for best results.');
        }
        
        function exportInventoryCSV() {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            let csv = '';
            
            if (document.getElementById('exportBlogs').checked && allBlogs.length > 0) {
                csv += 'BLOG POSTS\n';
                csv += 'Title,Keyword,Word Count,Status,Created\n';
                allBlogs.forEach(b => {
                    csv += `"${(b.title || '').replace(/"/g, '""')}","${b.primary_keyword || ''}",${b.word_count || 0},"${b.status || 'draft'}","${b.created_at || ''}"\n`;
                });
                csv += '\n';
            }
            
            if (document.getElementById('exportSocial').checked && allSocial.length > 0) {
                csv += 'SOCIAL POSTS\n';
                csv += 'Platform,Topic,Status,Created\n';
                allSocial.forEach(s => {
                    csv += `"${s.platform || ''}","${(s.topic || '').replace(/"/g, '""')}","${s.status || 'draft'}","${s.created_at || ''}"\n`;
                });
                csv += '\n';
            }
            
            if (document.getElementById('exportKeywords').checked) {
                csv += 'KEYWORDS\n';
                csv += 'Keyword,Type\n';
                (currentClient.primary_keywords || []).forEach(k => {
                    csv += `"${k}","primary"\n`;
                });
                (currentClient.secondary_keywords || []).forEach(k => {
                    csv += `"${k}","secondary"\n`;
                });
            }
            
            if (!csv) {
                alert('No data selected for export');
                return;
            }
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentClient.business_name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'client'}-content-inventory.csv`;
            a.click();
        }
        
        function exportInventoryHTML() {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            let content = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Content Inventory - ${currentClient.business_name}</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        h1 { color: #1e293b; }
        h2 { color: #334155; margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f8fafc; color: #64748b; font-weight: 600; }
        .status-draft { color: #f59e0b; }
        .status-published { color: #10b981; }
    </style>
</head>
<body>
    <h1>Content Inventory: ${currentClient.business_name}</h1>
    <p>Generated: ${new Date().toLocaleString()}</p>
`;
            
            if (document.getElementById('exportBlogs').checked && allBlogs.length > 0) {
                content += `<h2>Blog Posts (${allBlogs.length})</h2><table><tr><th>Title</th><th>Keyword</th><th>Words</th><th>Status</th></tr>`;
                allBlogs.forEach(b => {
                    content += `<tr><td>${escapeHtml(b.title || 'Untitled')}</td><td>${escapeHtml(b.primary_keyword || '')}</td><td>${b.word_count || 0}</td><td class="status-${b.status || 'draft'}">${b.status || 'draft'}</td></tr>`;
                });
                content += '</table>';
            }
            
            if (document.getElementById('exportSocial').checked && allSocial.length > 0) {
                content += `<h2>Social Posts (${allSocial.length})</h2><table><tr><th>Platform</th><th>Topic</th><th>Status</th></tr>`;
                allSocial.forEach(s => {
                    content += `<tr><td>${escapeHtml(s.platform || '')}</td><td>${escapeHtml(s.topic || '')}</td><td class="status-${s.status || 'draft'}">${s.status || 'draft'}</td></tr>`;
                });
                content += '</table>';
            }
            
            if (document.getElementById('exportKeywords').checked) {
                const keywords = [...(currentClient.primary_keywords || []), ...(currentClient.secondary_keywords || [])];
                if (keywords.length > 0) {
                    content += `<h2>Keywords (${keywords.length})</h2><ul>`;
                    keywords.forEach(k => content += `<li>${escapeHtml(k)}</li>`);
                    content += '</ul>';
                }
            }
            
            content += '</body></html>';
            
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentClient.business_name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'client'}-content-inventory.html`;
            a.click();
        }
        
        function generateClientSummary() {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }
            
            const branding = JSON.parse(localStorage.getItem('mcp_branding') || '{}');
            const agencyName = branding.agencyName || 'MCP Framework';
            const totalWords = allBlogs.reduce((sum, b) => sum + (b.word_count || 0), 0);
            
            const summaryHTML = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Client Summary - ${currentClient.business_name}</title>
    <style>
        @page { size: letter; margin: 0.5in; }
        body { font-family: Arial, sans-serif; color: #333; max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 3px solid #667eea; margin-bottom: 30px; }
        .header h1 { margin: 0; color: #1e293b; }
        .header .agency { color: #667eea; font-weight: bold; }
        .client-info { background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 30px; }
        .client-info h2 { margin: 0 0 10px 0; color: #667eea; }
        .metrics { display: flex; gap: 20px; margin-bottom: 30px; }
        .metric { flex: 1; text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 12px; }
        .metric h3 { margin: 0; font-size: 32px; }
        .metric p { margin: 5px 0 0 0; opacity: 0.9; }
        .section { margin-bottom: 25px; }
        .section h3 { color: #334155; margin-bottom: 10px; }
        .tag { display: inline-block; background: #e2e8f0; padding: 4px 12px; border-radius: 20px; margin: 4px; font-size: 14px; }
        .footer { text-align: center; color: #94a3b8; font-size: 11px; padding-top: 20px; border-top: 1px solid #e2e8f0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Client Summary</h1>
        <div class="agency">${escapeHtml(agencyName)}</div>
    </div>
    
    <div class="client-info">
        <h2>${escapeHtml(currentClient.business_name || 'Client')}</h2>
        <p><strong>Industry:</strong> ${escapeHtml(currentClient.industry || 'N/A')} | <strong>Location:</strong> ${escapeHtml(currentClient.geo || 'N/A')}</p>
    </div>
    
    <div class="metrics">
        <div class="metric">
            <h3>${allBlogs.length}</h3>
            <p>Blog Posts</p>
        </div>
        <div class="metric">
            <h3>${allSocial.length}</h3>
            <p>Social Posts</p>
        </div>
        <div class="metric">
            <h3>${totalWords.toLocaleString()}</h3>
            <p>Words Written</p>
        </div>
    </div>
    
    <div class="section">
        <h3>Target Keywords</h3>
        <div>
            ${(currentClient.primary_keywords || []).slice(0, 8).map(k => `<span class="tag">${escapeHtml(k)}</span>`).join('')}
            ${(currentClient.primary_keywords || []).length > 8 ? `<span class="tag">+${(currentClient.primary_keywords || []).length - 8} more</span>` : ''}
        </div>
    </div>
    
    <div class="section">
        <h3>Recent Content</h3>
        <ul>
            ${allBlogs.slice(0, 5).map(b => `<li>${escapeHtml(b.title || 'Untitled')} (${b.word_count || 0} words)</li>`).join('')}
            ${allBlogs.length === 0 ? '<li>No content yet</li>' : ''}
        </ul>
    </div>
    
    <div class="section">
        <h3>Next Steps</h3>
        <ul>
            <li>Continue publishing ${currentClient.primary_keywords?.[0] || 'targeted'} content weekly</li>
            <li>Maintain social media posting schedule (3x/week)</li>
            <li>Monitor keyword rankings and adjust strategy</li>
        </ul>
    </div>
    
    <div class="footer">
        <p>Prepared by ${escapeHtml(agencyName)}  ${new Date().toLocaleDateString()}</p>
    </div>
</body>
</html>`;
            
            const blob = new Blob([summaryHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentClient.business_name?.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'client'}-summary.html`;
            a.click();
        }
        
        function checkFirstTimeUser() {
            const tourCompleted = localStorage.getItem('mcp_tour_completed');
            if (!tourCompleted) {
                // Wait a moment for the dashboard to load, then offer the tour
                setTimeout(() => {
                    if (confirm('Welcome! Would you like a quick tour of the Content Dashboard?')) {
                        startTour();
                    } else {
                        localStorage.setItem('mcp_tour_completed', 'true');
                    }
                }, 1000);
            }
        }
        
        // Call after login
        const originalLoadClients = loadClients;
        loadClients = async function() {
            await originalLoadClients();
            checkFirstTimeUser();
        };
    </script>
</body>
</html>
